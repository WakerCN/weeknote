import{j as e}from"./vendor-markdown-BqRWHW3K.js";import{r as l}from"./vendor-react-C5jCz3x-.js";import{u as v,b as i}from"./vendor-utils-BYlQswVI.js";import{b as q,c as H,e as M,f as B,h as G}from"./index-BE_47tt5.js";import{h as J,L as K,S as y,a as N,b as O}from"./form-utils-Ct5NYf6N.js";import"./vendor-ui-C1p9Nn89.js";import"./vendor-monaco-nD5yPjNo.js";function ee(){const[n,p]=l.useState(null),[d,h]=l.useState(""),[c,b]=l.useState(""),[m,x]=l.useState(""),[f,u]=l.useState(""),[s,j]=l.useState(!1),g=l.useRef(null),{data:a,loading:k,refresh:w}=v(q,{onSuccess:t=>{!n&&t.templates.length>0&&p(t.activeTemplateId)}}),o=(a==null?void 0:a.templates)||[],P=a==null?void 0:a.activeTemplateId,r=a==null?void 0:a.defaults;l.useEffect(()=>{if(s)h(""),b(""),x((r==null?void 0:r.systemPrompt)||""),u((r==null?void 0:r.userPromptTemplate)||""),g.current=null;else if(n){const t=o.find(F=>F.id===n);t&&(h(t.name),b(t.description||""),x(t.systemPrompt),u(t.userPromptTemplate),g.current={name:t.name,description:t.description||"",systemPrompt:t.systemPrompt,userPromptTemplate:t.userPromptTemplate})}},[n,s,o,r]);const S=l.useMemo(()=>s?d.trim()!==""||c.trim()!=="":J({name:d,description:c,systemPrompt:m,userPromptTemplate:f},g.current),[s,d,c,m,f]),I=()=>{if(s)h(""),b(""),x((r==null?void 0:r.systemPrompt)||""),u((r==null?void 0:r.userPromptTemplate)||""),i.info("已重置");else if(g.current){const t=g.current;h(t.name),b(t.description),x(t.systemPrompt),u(t.userPromptTemplate),i.info("已重置为原始配置")}},{loading:L,run:R}=v(async()=>{if(!d.trim())throw new Error("模板名称不能为空");if(!m.trim())throw new Error("系统提示词不能为空");if(!f.includes("{{dailyLog}}"))throw new Error("用户提示词模板必须包含 {{dailyLog}} 占位符");s?(await H({name:d.trim(),description:c.trim()||void 0,systemPrompt:m,userPromptTemplate:f}),j(!1)):n&&await M(n,{name:d.trim(),description:c.trim()||void 0,systemPrompt:m,userPromptTemplate:f}),await w()},{manual:!0,onSuccess:()=>i.success(s?"模板创建成功！":"保存成功！"),onError:t=>i.error(t.message||"保存失败")}),{loading:C,run:A}=v(async()=>{if(n){if(o.length<=1)throw new Error("至少需要保留一个模板");await B(n),p(null),await w()}},{manual:!0,onSuccess:()=>i.success("模板已删除"),onError:t=>i.error(t.message||"删除失败")}),{loading:T,run:z}=v(async()=>{n&&(await G(n),await w())},{manual:!0,onSuccess:()=>i.success("模板已激活"),onError:t=>i.error(t.message||"激活失败")}),U=()=>{r&&(x(r.systemPrompt),u(r.userPromptTemplate),i.info("已重置为默认提示词（需保存生效）"))},$=()=>{j(!0),p(null)},E=()=>{j(!1),o.length>0&&p(P||o[0].id)};if(k)return e.jsx(K,{});const D=n===P;return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("header",{className:"h-14 flex items-center justify-between px-6 bg-[#161b22] border-b border-[#30363d] shrink-0",children:[e.jsx("h2",{className:"text-lg font-semibold text-[#f0f6fc]",children:"Prompt 模板"}),!s&&n&&!D&&e.jsx("button",{onClick:z,disabled:T,className:"px-4 py-2 rounded-lg font-medium text-sm transition-all duration-200 bg-[#21262d] text-[#f0f6fc] hover:bg-[#30363d] border border-[#30363d]",children:T?"激活中...":"设为默认"})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("aside",{className:"w-60 ml-4 my-4 bg-[#161b22] border border-[#30363d] rounded-lg flex flex-col shrink-0 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-[#30363d]",children:e.jsx("button",{onClick:$,disabled:s,className:`w-full px-4 py-2 rounded-lg font-medium text-sm transition-all duration-200 ${s?"bg-[#21262d] text-[#484f58] cursor-not-allowed":"bg-[#238636] text-white hover:bg-[#2ea043]"}`,children:"+ 新建模板"})}),e.jsxs("div",{className:"flex-1 overflow-auto p-3 space-y-2",children:[s&&e.jsxs("div",{className:"p-3 rounded-lg border-2 border-dashed border-[#58a6ff] bg-[#58a6ff]/10",children:[e.jsx("div",{className:"font-medium text-[#58a6ff] text-sm",children:"新建模板"}),e.jsx("div",{className:"text-xs text-[#8b949e] mt-1",children:"填写右侧表单并保存"}),e.jsx("button",{onClick:E,className:"mt-2 text-xs text-[#f85149] hover:underline",children:"取消创建"})]}),o.map(t=>e.jsxs("button",{onClick:()=>{j(!1),p(t.id)},className:`w-full p-3 rounded-lg border text-left transition-all duration-200 ${!s&&n===t.id?"bg-[#0d1117] border-[#58a6ff]":"bg-[#0d1117] border-[#30363d] hover:border-[#484f58]"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium text-[#f0f6fc] text-sm truncate",children:t.name}),t.id===P&&e.jsx("span",{className:"text-xs text-emerald-400 shrink-0 ml-2",children:"● 默认"})]}),t.description&&e.jsx("div",{className:"text-xs text-[#8b949e] mt-1 truncate",children:t.description}),e.jsxs("div",{className:"text-xs text-[#484f58] mt-1",children:["更新于 ",new Date(t.updatedAt).toLocaleDateString("zh-CN")]})]},t.id))]})]}),e.jsx("main",{className:"flex-1 overflow-auto p-4 pb-20",children:e.jsxs("div",{className:"max-w-3xl space-y-6",children:[e.jsxs(y,{children:[e.jsx(N,{title:"基本信息"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-[#8b949e] mb-2",children:["模板名称 ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:d,onChange:t=>h(t.target.value),placeholder:"例如：简洁版、详细版",className:"w-full px-3 py-2 bg-[#0d1117] border border-[#30363d] rounded-lg text-[#f0f6fc] placeholder-[#484f58] focus:outline-none focus:border-[#58a6ff]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[#8b949e] mb-2",children:"描述（可选）"}),e.jsx("input",{type:"text",value:c,onChange:t=>b(t.target.value),placeholder:"简要描述这个模板的特点",className:"w-full px-3 py-2 bg-[#0d1117] border border-[#30363d] rounded-lg text-[#f0f6fc] placeholder-[#484f58] focus:outline-none focus:border-[#58a6ff]"})]})]})]}),e.jsxs(y,{children:[e.jsx(N,{title:"系统提示词 (System Prompt)",description:"定义 AI 的角色和行为规则，包括输出格式要求。",action:e.jsx("button",{onClick:U,className:"text-xs text-[#58a6ff] hover:underline",children:"重置为默认"})}),e.jsx("textarea",{value:m,onChange:t=>x(t.target.value),rows:14,className:"w-full px-3 py-2 bg-[#0d1117] border border-[#30363d] rounded-lg text-[#f0f6fc] placeholder-[#484f58] focus:outline-none focus:border-[#58a6ff] font-mono text-sm resize-y",placeholder:"输入系统提示词..."})]}),e.jsxs(y,{children:[e.jsx(N,{title:"用户提示词模板 (User Prompt Template)"}),e.jsxs("p",{className:"text-sm text-[#8b949e] mb-2",children:["使用 ",e.jsx("code",{className:"px-1.5 py-0.5 bg-[#0d1117] rounded text-[#58a6ff]",children:"{{dailyLog}}"})," 作为日志内容的占位符。"]}),e.jsxs("div",{className:"text-xs text-yellow-400 mb-4",children:["注意：模板中必须包含 ","{{dailyLog}}"," 占位符，运行时会被实际的日志内容替换。"]}),e.jsx("textarea",{value:f,onChange:t=>u(t.target.value),rows:8,className:"w-full px-3 py-2 bg-[#0d1117] border border-[#30363d] rounded-lg text-[#f0f6fc] placeholder-[#484f58] focus:outline-none focus:border-[#58a6ff] font-mono text-sm resize-y",placeholder:"输入用户提示词模板..."})]}),!s&&n&&e.jsxs(y,{danger:!0,children:[e.jsx(N,{title:"危险操作",danger:!0}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-[#f0f6fc]",children:"删除此模板"}),e.jsxs("div",{className:"text-xs text-[#8b949e] mt-1",children:["删除后无法恢复，请谨慎操作。",o.length<=1&&" （至少需要保留一个模板）"]})]}),e.jsx("button",{onClick:A,disabled:C||o.length<=1,className:`px-4 py-2 rounded-lg font-medium text-sm transition-all duration-200 ${C||o.length<=1?"bg-[#21262d] text-[#484f58] cursor-not-allowed":"bg-[#f85149] text-white hover:bg-[#da3633]"}`,children:C?"删除中...":"删除模板"})]})]})]})})]}),e.jsx(O,{status:s?"creating":S?"changed":"synced",showReset:S||s,resetText:s?"取消":"重置",onReset:s?E:I,saveText:s?"创建模板":"保存修改",onSave:R,saving:L,saveDisabled:!s&&!S})]})}export{ee as default};
