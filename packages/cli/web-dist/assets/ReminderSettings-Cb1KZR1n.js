import{j as e}from"./vendor-markdown-BqRWHW3K.js";import{r as o}from"./vendor-react-C5jCz3x-.js";import{u as G,b as x}from"./vendor-utils-BYlQswVI.js";import{i as B,j as J,t as O,k as P}from"./index-BE_47tt5.js";import{h as Q,L as U,S as u,a as g,b as V}from"./form-utils-Ct5NYf6N.js";import"./vendor-ui-C1p9Nn89.js";import"./vendor-monaco-nD5yPjNo.js";function F({enabled:n,onChange:c,size:l="md"}){const d={sm:{track:"h-5 w-9",thumb:"h-4 w-4",translate:"translate-x-4"},md:{track:"h-6 w-11",thumb:"h-5 w-5",translate:"translate-x-5"}},{track:r,thumb:i,translate:t}=d[l];return e.jsx("button",{type:"button",role:"switch","aria-checked":n,onClick:()=>c(!n),className:`
        relative inline-flex ${r} shrink-0 cursor-pointer rounded-full 
        border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none
        ${n?"bg-emerald-500":"bg-[#484f58]"}
      `,children:e.jsx("span",{className:`
          pointer-events-none inline-block ${i} rounded-full bg-white shadow-lg ring-0 
          transition duration-200 ease-in-out
          ${n?t:"translate-x-0"}
        `})})}function $({label:n,hour:c,minute:l,enabled:d,onChange:r}){return e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-[#0d1117] rounded-lg border border-[#30363d]",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:i=>r({enabled:i.target.checked}),className:"w-4 h-4 rounded border-[#30363d] bg-[#161b22] text-emerald-500 focus:ring-emerald-500/20"}),e.jsx("span",{className:`text-sm ${d?"text-[#f0f6fc]":"text-[#484f58]"}`,children:n})]}),e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx("select",{value:c,onChange:i=>r({hour:parseInt(i.target.value,10)}),disabled:!d,className:"px-2 py-1 bg-[#161b22] border border-[#30363d] rounded text-sm text-[#f0f6fc] disabled:opacity-50 disabled:cursor-not-allowed",children:Array.from({length:24},(i,t)=>e.jsx("option",{value:t,children:String(t).padStart(2,"0")},t))}),e.jsx("span",{className:"text-[#8b949e]",children:":"}),e.jsx("select",{value:l,onChange:i=>r({minute:parseInt(i.target.value,10)}),disabled:!d,className:"px-2 py-1 bg-[#161b22] border border-[#30363d] rounded text-sm text-[#f0f6fc] disabled:opacity-50 disabled:cursor-not-allowed",children:Array.from({length:60},(i,t)=>e.jsx("option",{value:t,children:String(t).padStart(2,"0")},t))})]})]})}function q({icon:n,title:c,enabled:l,onToggle:d,children:r}){return e.jsxs("div",{className:"p-4 bg-[#0d1117] rounded-lg border border-[#30363d]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:n}),e.jsx("span",{className:"font-medium text-[#f0f6fc]",children:c})]}),e.jsx(F,{enabled:l,onChange:d,size:"sm"})]}),r]})}function ae(){const[n,c]=o.useState(null),[l,d]=o.useState(""),[r,i]=o.useState(""),[t,b]=o.useState(""),[_,p]=o.useState(!1),[h,v]=o.useState(null),m=o.useRef(null),{loading:A,refresh:I}=G(B,{onSuccess:s=>{var S,w,E,D,K,R,H,T,M,W;c(s);const a=((w=(S=s.channels)==null?void 0:S.dingtalk)==null?void 0:w.webhook)||"",y=((D=(E=s.channels)==null?void 0:E.dingtalk)==null?void 0:D.secret)||"",C=((R=(K=s.channels)==null?void 0:K.serverChan)==null?void 0:R.sendKey)||"";d(a),i(y),b(C),m.current={enabled:s.enabled,dingtalkEnabled:((T=(H=s.channels)==null?void 0:H.dingtalk)==null?void 0:T.enabled)||!1,dingtalkWebhook:a,dingtalkSecret:y,serverChanEnabled:((W=(M=s.channels)==null?void 0:M.serverChan)==null?void 0:W.enabled)||!1,serverChanSendKey:C,morningEnabled:s.schedules.morning.enabled,morningHour:s.schedules.morning.hour,morningMinute:s.schedules.morning.minute,eveningEnabled:s.schedules.evening.enabled,eveningHour:s.schedules.evening.hour,eveningMinute:s.schedules.evening.minute}},onError:s=>x.error(s.message||"åŠ è½½é…ç½®å¤±è´¥")}),f=o.useMemo(()=>{if(!n)return!1;const s={enabled:n.enabled,dingtalkEnabled:n.channels.dingtalk.enabled,dingtalkWebhook:l,dingtalkSecret:r,serverChanEnabled:n.channels.serverChan.enabled,serverChanSendKey:t,morningEnabled:n.schedules.morning.enabled,morningHour:n.schedules.morning.hour,morningMinute:n.schedules.morning.minute,eveningEnabled:n.schedules.evening.enabled,eveningHour:n.schedules.evening.hour,eveningMinute:n.schedules.evening.minute};return Q(s,m.current)},[n,l,r,t]),j=(s,a)=>{n&&c({...n,channels:{...n.channels,[s]:{...n.channels[s],...a}}})},k=(s,a)=>{n&&c({...n,schedules:{...n.schedules,[s]:{...n.schedules[s],...a}}})},z=()=>{if(!m.current)return;const s=m.current;c(a=>a&&{...a,enabled:s.enabled,channels:{dingtalk:{enabled:s.dingtalkEnabled,webhook:s.dingtalkWebhook,secret:s.dingtalkSecret},serverChan:{enabled:s.serverChanEnabled,sendKey:s.serverChanSendKey}},schedules:{morning:{enabled:s.morningEnabled,hour:s.morningHour,minute:s.morningMinute},evening:{enabled:s.eveningEnabled,hour:s.eveningHour,minute:s.eveningMinute}}}),d(s.dingtalkWebhook),i(s.dingtalkSecret),b(s.serverChanSendKey),x.info("å·²é‡ç½®ä¸ºåŸå§‹é…ç½®")},L=async()=>{if(n){p(!0);try{const s={enabled:n.enabled,channels:{dingtalk:{enabled:n.channels.dingtalk.enabled,webhook:l.trim(),secret:r.trim()},serverChan:{enabled:n.channels.serverChan.enabled,sendKey:t.trim()}},schedules:n.schedules};await J(s),x.success("é…ç½®ä¿å­˜æˆåŠŸ"),await I()}catch(s){x.error(s instanceof Error?s.message:"ä¿å­˜å¤±è´¥")}finally{p(!1)}}},N=async s=>{v(s);try{const a=s==="dingtalk"?await O(l.trim(),r.trim()||void 0):await P(t.trim());a.success?x.success(s==="dingtalk"?"é’‰é’‰æµ‹è¯•æ¶ˆæ¯å‘é€æˆåŠŸ":"æµ‹è¯•æ¶ˆæ¯å‘é€æˆåŠŸï¼Œè¯·æŸ¥çœ‹å¾®ä¿¡"):x.error(a.error||"å‘é€å¤±è´¥")}catch(a){x.error(a instanceof Error?a.message:"æµ‹è¯•å¤±è´¥")}finally{v(null)}};return A||!n?e.jsx(U,{}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("header",{className:"h-14 flex items-center px-6 bg-[#161b22] border-b border-[#30363d] shrink-0",children:e.jsx("h2",{className:"text-lg font-semibold text-[#f0f6fc]",children:"æé†’è®¾ç½®"})}),e.jsx("main",{className:"flex-1 overflow-auto p-6 pb-20",children:e.jsxs("div",{className:"max-w-3xl space-y-6",children:[e.jsx(u,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-[#f0f6fc]",children:"å¯ç”¨æé†’"}),e.jsx("p",{className:"text-sm text-[#8b949e] mt-1",children:"å¼€å¯åï¼Œå°†åœ¨æ³•å®šå·¥ä½œæ—¥é€šè¿‡å·²é…ç½®çš„æ¸ é“æ¨é€æé†’"}),e.jsx("p",{className:"text-xs text-[#484f58] mt-1",children:"ğŸ’¡ è‡ªåŠ¨è·³è¿‡èŠ‚å‡æ—¥ï¼ŒåŒ…å«è°ƒä¼‘å·¥ä½œæ—¥"})]}),e.jsx(F,{enabled:n.enabled,onChange:s=>c({...n,enabled:s})})]})}),e.jsxs(u,{children:[e.jsx(g,{title:"æ¨é€æ¸ é“"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(q,{icon:"ğŸ¤–",title:"é’‰é’‰æœºå™¨äºº",enabled:n.channels.dingtalk.enabled,onToggle:s=>j("dingtalk",{enabled:s}),children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-[#8b949e] mb-1.5",children:"Webhook åœ°å€"}),e.jsx("input",{type:"text",value:l,onChange:s=>d(s.target.value),placeholder:"https://oapi.dingtalk.com/robot/send?access_token=...",className:"w-full px-3 py-2 bg-[#161b22] border border-[#30363d] rounded-lg text-[#f0f6fc] placeholder-[#484f58] focus:outline-none focus:border-[#58a6ff] text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-[#8b949e] mb-1.5",children:["åŠ ç­¾å¯†é’¥ ",e.jsx("span",{className:"text-[#484f58]",children:"(å¯é€‰ï¼Œæ¨èé…ç½®)"})]}),e.jsx("input",{type:"text",value:r,onChange:s=>i(s.target.value),placeholder:"SECxxxxxxxxxxxxxxxxxxxxxxxx",className:"w-full px-3 py-2 bg-[#161b22] border border-[#30363d] rounded-lg text-[#f0f6fc] placeholder-[#484f58] focus:outline-none focus:border-[#58a6ff] text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-1",children:[e.jsx("p",{className:"text-xs text-[#484f58]",children:"ğŸ’¡ åœ¨é’‰é’‰ç¾¤è®¾ç½®ä¸­æ·»åŠ è‡ªå®šä¹‰æœºå™¨äººè·å– Webhook"}),e.jsx("button",{onClick:()=>N("dingtalk"),disabled:h==="dingtalk"||!l.trim(),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all duration-200 ${h==="dingtalk"||!l.trim()?"bg-[#21262d] text-[#484f58] cursor-not-allowed":"bg-[#21262d] text-[#f0f6fc] hover:bg-[#30363d]"}`,children:h==="dingtalk"?"å‘é€ä¸­...":"æµ‹è¯•"})]})]})}),e.jsx(q,{icon:"ğŸ“±",title:"Serveré…±ï¼ˆå¾®ä¿¡æ¨é€ï¼‰",enabled:n.channels.serverChan.enabled,onToggle:s=>j("serverChan",{enabled:s}),children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-[#8b949e] mb-1.5",children:"SendKey"}),e.jsx("input",{type:"text",value:t,onChange:s=>b(s.target.value),placeholder:"SCTxxxxxxxxxxxxxxxxxxx",className:"w-full px-3 py-2 bg-[#161b22] border border-[#30363d] rounded-lg text-[#f0f6fc] placeholder-[#484f58] focus:outline-none focus:border-[#58a6ff] text-sm"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-1",children:[e.jsxs("p",{className:"text-xs text-[#484f58]",children:["ğŸ’¡ è®¿é—® ",e.jsx("a",{href:"https://sct.ftqq.com/",target:"_blank",rel:"noopener noreferrer",className:"text-[#58a6ff] hover:underline",children:"sct.ftqq.com"})," ç”¨ GitHub ç™»å½•è·å–ï¼Œæ¯å¤©å…è´¹ 5 æ¡"]}),e.jsx("button",{onClick:()=>N("serverChan"),disabled:h==="serverChan"||!t.trim(),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all duration-200 ${h==="serverChan"||!t.trim()?"bg-[#21262d] text-[#484f58] cursor-not-allowed":"bg-[#21262d] text-[#f0f6fc] hover:bg-[#30363d]"}`,children:h==="serverChan"?"å‘é€ä¸­...":"æµ‹è¯•"})]})]})})]})]}),e.jsxs(u,{children:[e.jsx(g,{title:"æé†’æ—¶é—´",description:"è®¾ç½®æ¯å¤©çš„æé†’æ—¶é—´"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx($,{label:"ä¸Šåˆæé†’",hour:n.schedules.morning.hour,minute:n.schedules.morning.minute,enabled:n.schedules.morning.enabled,onChange:s=>k("morning",s)}),e.jsx($,{label:"æ™šé—´æé†’",hour:n.schedules.evening.hour,minute:n.schedules.evening.minute,enabled:n.schedules.evening.enabled,onChange:s=>k("evening",s)})]})]}),e.jsxs(u,{children:[e.jsx(g,{title:"èŠ‚å‡æ—¥æ•°æ®"}),n.holidayData?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-emerald-400",children:"âœ“"}),e.jsxs("span",{className:"text-[#f0f6fc]",children:[n.holidayData.year,"å¹´æ•°æ®å·²åŠ è½½"]})]}),e.jsxs("p",{className:"text-sm text-[#8b949e]",children:["æ•°æ®æ¥æºï¼š",n.holidayData.source]}),e.jsxs("p",{className:"text-xs text-[#484f58]",children:["æ›´æ–°æ—¶é—´ï¼š",n.holidayData.updatedAt," Â· ",n.holidayData.holidaysCount," ä¸ªèŠ‚å‡æ—¥ Â· ",n.holidayData.workdaysCount," ä¸ªè°ƒä¼‘å·¥ä½œæ—¥"]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-yellow-400",children:"âš "}),e.jsx("span",{className:"text-[#8b949e]",children:"å½“å‰å¹´ä»½æš‚æ— èŠ‚å‡æ—¥æ•°æ®ï¼Œå°†ä½¿ç”¨å‘¨æœ«åˆ¤æ–­"})]})]}),e.jsxs(u,{children:[e.jsx(g,{title:"å®šæ—¶ä»»åŠ¡çŠ¶æ€"}),e.jsx("div",{className:"flex items-center gap-2",children:n.scheduler.running?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-400 animate-pulse"}),e.jsx("span",{className:"text-emerald-400",children:"è¿è¡Œä¸­"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-[#484f58]"}),e.jsx("span",{className:"text-[#8b949e]",children:"æœªè¿è¡Œ"})]})}),!n.scheduler.running&&n.enabled&&e.jsx("p",{className:"text-xs text-yellow-400 mt-2",children:"ğŸ’¡ ä¿å­˜é…ç½®åå®šæ—¶ä»»åŠ¡å°†è‡ªåŠ¨å¯åŠ¨"})]})]})}),e.jsx(V,{status:f?"changed":"synced",showReset:f,onReset:z,saveText:"ä¿å­˜é…ç½®",onSave:L,saving:_,saveDisabled:!f})]})}export{ae as default};
