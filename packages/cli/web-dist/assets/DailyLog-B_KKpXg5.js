import{j as e}from"./vendor-markdown-ClRIg9ty.js";import{r as j,i as $}from"./vendor-react-C5jCz3x-.js";import{b as O,c as R,u as M}from"./vendor-utils-DKxk67Gj.js";import{o as F,u as T,i as J,j as P,k as B,l as Y,m as H,n as A}from"./index-UpF3X2KG.js";import{j as q,k as z,H as _,l as K}from"./vendor-ui-CubQTjIw.js";import"./vendor-monaco-nD5yPjNo.js";const U=["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"];function X(o){const r=typeof o=="string"?new Date(o):o;return U[r.getDay()]}function G(o){const c=(typeof o=="string"?new Date(o):o).getDay();return c===0||c===6}function Q(o){const r=[],c=new Date(o);for(let h=0;h<7;h++){const p=new Date(c);p.setDate(c.getDate()+h);const v=p.toISOString().split("T")[0];r.push({date:v,dayOfWeek:X(p),isWeekend:G(p)})}return r}function V(o=new Date){const r=new Date(o),c=r.getDay(),h=r.getDate()-c+(c===0?-6:1);return r.setDate(h),r.setHours(0,0,0,0),r.toISOString().split("T")[0]}function L(o){return o.slice(5)}function Z({weeks:o,selectedDate:r,onSelectDate:c,weekData:h={},currentWeekStart:p,onBackfill:v}){const[i,u]=j.useState(new Set([p])),[m,N]=j.useState({visible:!1,x:0,y:0,weekStart:""}),b=j.useRef(null);j.useEffect(()=>{const n=a=>{b.current&&!b.current.contains(a.target)&&N(t=>({...t,visible:!1}))};return m.visible&&(document.addEventListener("click",n),document.addEventListener("contextmenu",n)),()=>{document.removeEventListener("click",n),document.removeEventListener("contextmenu",n)}},[m.visible]);const D=n=>{const a=new Set(i);a.has(n)?a.delete(n):a.add(n),u(a)},W=(n,a)=>{n.preventDefault(),N({visible:!0,x:n.clientX,y:n.clientY,weekStart:a})},w=async()=>{try{await F(m.weekStart),O.success("å·²åœ¨èµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€")}catch{O.error("æ‰“å¼€å¤±è´¥")}N(n=>({...n,visible:!1}))},y=(n,a)=>{const t=[],d=new Date(n),x=new Date(a);for(let g=new Date(d);g<=x;g.setDate(g.getDate()+1))t.push(g.toISOString().split("T")[0]);return t},E=n=>{const a=h[n];return!!(a&&(a.plan.length>0||a.result.length>0||a.issues.length>0||a.notes.length>0))},S=n=>{const t=new Date(n).getDay();return t===0||t===6};return e.jsxs("div",{className:"h-full flex flex-col bg-[#161b22] border-r border-[#30363d]",children:[e.jsx("div",{className:"p-4 border-b border-[#30363d]",children:e.jsxs("h2",{className:"text-[#f0f6fc] font-semibold flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“…"}),e.jsx("span",{children:"åŽ†å²è®°å½•"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:o.length===0?e.jsx("div",{className:"p-4 text-center text-[#8b949e] text-sm",children:"æš‚æ— è®°å½•"}):e.jsx("div",{className:"p-2",children:o.map(n=>{const a=i.has(n.weekStart),t=y(n.weekStart,n.weekEnd),d=t.filter(s=>!S(s)),x=t.filter(s=>S(s)),g=x.some(s=>E(s));return e.jsxs("div",{className:"mb-2",children:[e.jsxs("button",{onClick:()=>D(n.weekStart),onContextMenu:s=>W(s,n.weekStart),className:"w-full px-3 py-2 rounded-lg flex items-center justify-between text-left hover:bg-[#21262d] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:`w-4 h-4 text-[#8b949e] transition-transform duration-200 ${a?"rotate-90":""}`}),e.jsxs("span",{className:"text-sm text-[#f0f6fc]",children:[n.year," / ",L(n.weekStart),"~",L(n.weekEnd)]})]}),e.jsxs("span",{className:"text-xs text-[#8b949e]",children:["(",n.filledDays,")"]})]}),e.jsx("div",{className:`grid transition-all duration-200 ease-out ${a?"grid-rows-[1fr] opacity-100":"grid-rows-[0fr] opacity-0"}`,children:e.jsx("div",{className:"overflow-hidden",children:e.jsxs("div",{className:"pl-6 mt-1 space-y-1",children:[d.map((s,C)=>{const l=E(s),f=r===s,k=h[s];return e.jsxs("button",{onClick:()=>c(s),style:{transitionDelay:a?`${C*100}ms`:"0ms"},className:`
                                w-full px-3 py-1.5 rounded-lg flex items-center justify-between text-left text-sm border
                                transition-all duration-150
                                ${a?"translate-x-0 opacity-100":"-translate-x-2 opacity-0"}
                                ${f?"bg-emerald-500/20 border-emerald-500/50 text-emerald-400":"border-transparent hover:bg-[#21262d] text-[#f0f6fc]"}
                              `,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-xs",children:L(s)}),e.jsx("span",{className:"text-xs text-[#8b949e]",children:(k==null?void 0:k.dayOfWeek)||""})]}),e.jsx("span",{className:l?"text-emerald-400":"text-[#484f58]",children:l?"â—":"â—‹"})]},s)}),x.length>0&&e.jsxs("div",{className:"pt-2 border-t border-[#30363d]",children:[e.jsxs("div",{className:"text-xs text-[#8b949e] px-3 py-1",children:["å‘¨æœ« ",g&&e.jsx("span",{className:"text-emerald-400",children:"æœ‰è®°å½•"})]}),x.map((s,C)=>{const l=E(s),f=r===s,k=h[s];return e.jsxs("button",{onClick:()=>c(s),style:{transitionDelay:a?`${(d.length+C)*30}ms`:"0ms"},className:`
                                    w-full px-3 py-1.5 rounded-lg flex items-center justify-between text-left text-sm border
                                    transition-all duration-150
                                    ${a?"translate-x-0 opacity-100":"-translate-x-2 opacity-0"}
                                    ${f?"bg-emerald-500/20 border-emerald-500/50 text-emerald-400":"border-transparent hover:bg-[#21262d] text-[#8b949e]"}
                                  `,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-xs",children:L(s)}),e.jsx("span",{className:"text-xs text-[#8b949e]",children:(k==null?void 0:k.dayOfWeek)||""})]}),e.jsx("span",{className:l?"text-emerald-400":"text-[#484f58]",children:l?"â—":"â—‹"})]},s)})]})]})})})]},n.fileName||n.weekStart)})})}),e.jsx("div",{className:"p-4 border-t border-[#30363d]",children:e.jsxs("button",{onClick:v,className:"w-full px-4 py-2 rounded-lg bg-[#21262d] text-[#f0f6fc] hover:bg-[#30363d] transition-colors flex items-center justify-center gap-2",children:[e.jsx("span",{children:"+"}),e.jsx("span",{children:"è¡¥å½•å…¶ä»–æ—¥æœŸ"})]})}),m.visible&&e.jsx("div",{ref:b,className:"fixed z-50 bg-[#21262d] border border-[#30363d] rounded-lg shadow-xl py-1 min-w-[160px]",style:{left:m.x,top:m.y},children:e.jsxs("button",{onClick:w,className:"w-full px-3 py-2 text-left text-sm text-[#f0f6fc] hover:bg-[#30363d] flex items-center gap-2 transition-colors",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{children:"åœ¨èµ„æºç®¡ç†å™¨ä¸­æ‰“å¼€"})]})})]})}const ee=o=>{const r=new Date(o),c=r.getMonth()+1,h=r.getDate();return`${c}æœˆ${h}æ—¥`};function te({date:o,record:r,onSave:c,onNavigate:h}){const[p,v]=j.useState([]),[i,u]=j.useState([]),[m,N]=j.useState([]),[b,D]=j.useState([]),[W,w]=j.useState("saved");j.useEffect(()=>{r?(v(r.plan||[]),u(r.result||[]),N(r.issues||[]),D(r.notes||[]),w("saved")):(v([]),u([]),N([]),D([]),w("saved"))},[r,o]);const{run:y}=R(async()=>{w("saving");try{await c({plan:p,result:i,issues:m,notes:b}),w("saved")}catch(x){w("unsaved"),console.error("ä¿å­˜å¤±è´¥:",x)}},{wait:1e3});j.useEffect(()=>{r?(JSON.stringify(p)!==JSON.stringify(r.plan)||JSON.stringify(i)!==JSON.stringify(r.result)||JSON.stringify(m)!==JSON.stringify(r.issues)||JSON.stringify(b)!==JSON.stringify(r.notes))&&(w("unsaved"),y()):(p.length>0||i.length>0||m.length>0||b.length>0)&&(w("unsaved"),y())},[p,i,m,b]);const E=(x,g,s)=>{const C={plan:v,result:u,issues:N,notes:D}[x];C(l=>{const f=[...l];return f[g]=s,f})},S=x=>{const g={plan:v,result:u,issues:N,notes:D}[x];g(s=>[...s,""])},n=(x,g)=>{const s={plan:v,result:u,issues:N,notes:D}[x];s(C=>C.filter((l,f)=>f!==g))},a=(x,g,s,C)=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-lg",children:g}),e.jsx("h3",{className:"text-[#f0f6fc] font-medium",children:x})]}),e.jsxs("div",{className:"space-y-2",children:[C.map((l,f)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-[#8b949e] mt-2",children:"-"}),e.jsx("input",{type:"text",value:l,onChange:k=>E(s,f,k.target.value),placeholder:`è¾“å…¥${x}...`,className:"flex-1 px-3 py-2 rounded-lg bg-[#0d1117] border border-[#30363d] text-[#f0f6fc] placeholder-[#484f58] focus:outline-none focus:border-emerald-500/50"}),e.jsx("button",{onClick:()=>n(s,f),className:"p-2 text-[#8b949e] hover:text-red-400 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},f)),e.jsx("button",{onClick:()=>S(s),className:"w-full px-3 py-2 rounded-lg border border-dashed border-[#30363d] text-[#8b949e] hover:border-emerald-500/50 hover:text-emerald-400 transition-colors text-sm",children:"+ æ·»åŠ ä¸€é¡¹"})]})]}),t=new Date(o),d=["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"][t.getDay()];return e.jsxs("div",{className:"h-full flex flex-col bg-[#0d1117]",children:[e.jsxs("div",{className:"p-4 border-b border-[#30363d] flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs("h2",{className:"text-lg font-semibold text-[#f0f6fc]",children:[ee(o)," ",d]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-sm text-[#8b949e]",children:[W==="saved"&&e.jsx("span",{className:"text-emerald-400",children:"âœ“ å·²ä¿å­˜"}),W==="saving"&&e.jsx("span",{className:"text-yellow-400",children:"ä¿å­˜ä¸­..."}),W==="unsaved"&&e.jsx("span",{className:"text-gray-500",children:"æœªä¿å­˜"})]}),e.jsx("button",{onClick:()=>h("prev"),className:"p-2 rounded-lg text-[#8b949e] hover:text-[#f0f6fc] hover:bg-[#21262d] transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:()=>h("next"),className:"p-2 rounded-lg text-[#8b949e] hover:text-[#f0f6fc] hover:bg-[#21262d] transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[a("Plan","ðŸ“‹","plan",p),a("Result","âœ…","result",i),a("Issues","âš ï¸","issues",m),a("Notes","ðŸ“","notes",b)]})]})}function se({value:o,onSelect:r,onClose:c,maxDate:h=new Date}){const[p,v]=j.useState(()=>{const t=o?new Date(o):new Date;return new Date(t.getFullYear(),t.getMonth(),1)}),i=p.getFullYear(),u=p.getMonth(),m=new Date(i,u,1).getDay(),N=new Date(i,u+1,0).getDate(),b=[];for(let t=0;t<m;t++)b.push(null);for(let t=1;t<=N;t++)b.push(t);const D=()=>{v(new Date(i,u-1,1))},W=()=>{v(new Date(i,u+1,1))},w=t=>{const d=new Date(i,u,t),x=d.toISOString().split("T")[0];d>h||(r(x),c())},y=t=>{const d=new Date;return i===d.getFullYear()&&u===d.getMonth()&&t===d.getDate()},E=t=>{if(!o)return!1;const d=new Date(o);return i===d.getFullYear()&&u===d.getMonth()&&t===d.getDate()},S=t=>new Date(i,u,t)>h,n=["ä¸€æœˆ","äºŒæœˆ","ä¸‰æœˆ","å››æœˆ","äº”æœˆ","å…­æœˆ","ä¸ƒæœˆ","å…«æœˆ","ä¹æœˆ","åæœˆ","åä¸€æœˆ","åäºŒæœˆ"],a=["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"];return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:c,children:e.jsxs("div",{className:"bg-[#161b22] border border-[#30363d] rounded-lg p-4 w-[320px] shadow-xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:D,className:"p-1 rounded hover:bg-[#21262d] text-[#8b949e] hover:text-[#f0f6fc]",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"text-[#f0f6fc] font-medium",children:[i,"å¹´ ",n[u]]}),e.jsx("button",{onClick:W,className:"p-1 rounded hover:bg-[#21262d] text-[#8b949e] hover:text-[#f0f6fc]",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:a.map(t=>e.jsx("div",{className:"text-center text-xs text-[#8b949e] py-1",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:b.map((t,d)=>{if(t===null)return e.jsx("div",{},d);const x=y(t),g=E(t),s=S(t);return e.jsx("button",{onClick:()=>!s&&w(t),disabled:s,className:`
                  aspect-square rounded text-sm transition-colors
                  ${s?"text-[#484f58] cursor-not-allowed":g?"bg-emerald-500 text-white":x?"bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30":"text-[#f0f6fc] hover:bg-[#21262d]"}
                `,children:t},d)})}),e.jsx("div",{className:"mt-4 text-xs text-[#8b949e] text-center",children:"ðŸ’¡ åªèƒ½é€‰æ‹©ä»Šå¤©åŠä¹‹å‰çš„æ—¥æœŸ"}),e.jsx("div",{className:"mt-4 flex gap-2",children:e.jsx("button",{onClick:c,className:"flex-1 px-4 py-2 rounded-lg bg-[#21262d] text-[#f0f6fc] hover:bg-[#30363d] transition-colors",children:"å–æ¶ˆ"})})]})})}function ie(){const{date:o}=$(),r=T(),[c,h]=j.useState(()=>o||new Date().toISOString().split("T")[0]),[p,v]=j.useState(!1),[i,u]=j.useState(()=>V()),{data:m,refresh:N}=M(J),{data:b,refresh:D}=M(()=>P(c),{onSuccess:l=>{l&&u(l.weekStart)}}),{data:W,refresh:w}=M(()=>B(c),{refreshDeps:[c]}),{data:y}=M(()=>Y(c));j.useEffect(()=>{o&&h(o)},[o]);const E=async l=>{try{await H(c,l),await w(),await D(),await N()}catch(f){throw O.error(f instanceof Error?f.message:"ä¿å­˜å¤±è´¥"),f}},S=l=>{h(l),r(`/daily/${l}`,{replace:!0})},n=l=>{const f=new Date(c),k=new Date(f);k.setDate(f.getDate()+(l==="next"?1:-1));const I=k.toISOString().split("T")[0];S(I)},a=()=>{v(!0)},t=l=>{S(l)},d=async()=>{try{const{text:l}=await A(c);if(!l){O.warning("æœ¬å‘¨æš‚æ— è®°å½•");return}r("/",{state:{dailyLog:l},scope:"root"}),O.success("å·²å¯¼å…¥åˆ°é¦–é¡µ")}catch(l){O.error(l instanceof Error?l.message:"å¯¼å‡ºå¤±è´¥")}},x=(m==null?void 0:m.weeks)||[],g=(b==null?void 0:b.days)||{},s=[...x];if(!s.some(l=>l.weekStart===i)){const l=Q(i),f=l[l.length-1].date;s.unshift({fileName:"",year:new Date(i).getFullYear(),week:0,weekStart:i,weekEnd:f,filledDays:0,lastUpdated:new Date().toISOString()})}return e.jsxs("div",{className:"h-screen w-screen flex flex-col bg-[#0d1117]",children:[e.jsxs("header",{className:"h-14 flex items-center justify-between px-6 bg-[#161b22] border-b border-[#30363d]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-400 to-cyan-500 flex items-center justify-center text-white font-bold text-sm",children:"W"}),e.jsx("h1",{className:"text-lg font-semibold text-[#f0f6fc]",children:"WeekNote"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm text-[#8b949e]",children:"æ¯æ—¥è®°å½•"}),e.jsx("button",{onClick:()=>r("/",{scope:"root"}),className:"p-2 rounded-lg text-[#8b949e] hover:text-[#f0f6fc] hover:bg-[#21262d] transition-colors",title:"é¦–é¡µ",children:e.jsx(_,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>r("/settings",{scope:"root"}),className:"p-2 rounded-lg text-[#8b949e] hover:text-[#f0f6fc] hover:bg-[#21262d] transition-colors",title:"è®¾ç½®",children:e.jsx(K,{className:"w-5 h-5"})})]})]}),e.jsxs("main",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"w-64 flex-shrink-0",children:e.jsx(Z,{weeks:s,selectedDate:c,onSelectDate:S,weekData:g,currentWeekStart:i,onBackfill:a})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(te,{date:c,record:W||null,onSave:E,onNavigate:n})})]}),e.jsxs("div",{className:"h-16 flex items-center justify-between px-6 bg-[#161b22] border-t border-[#30363d]",children:[e.jsx("div",{className:"text-sm text-[#8b949e]",children:y&&e.jsxs(e.Fragment,{children:["æœ¬å‘¨å·²è®°å½• ",y.weekdaysFilled,"/5 ä¸ªå·¥ä½œæ—¥",y.filledDays>y.weekdaysFilled&&e.jsxs("span",{className:"ml-2 text-[#484f58]",children:["ï¼ˆå«å‘¨æœ« ",y.filledDays-y.weekdaysFilled," å¤©ï¼‰"]})]})}),e.jsx("button",{onClick:d,className:"px-6 py-2 rounded-lg bg-gradient-to-r from-emerald-500 to-cyan-500 text-white hover:from-emerald-400 hover:to-cyan-400 transition-all font-medium text-sm",children:"ðŸš€ å¯¼å…¥æœ¬å‘¨åˆ°é¦–é¡µç”Ÿæˆå‘¨æŠ¥"})]}),p&&e.jsx(se,{value:c,onSelect:t,onClose:()=>v(!1)})]})}export{ie as default};
