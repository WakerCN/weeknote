import{j as e}from"./vendor-markdown-CCDUxFZN.js";import{r as d}from"./vendor-react-BCbWnUzD.js";import{u as g,b as o}from"./vendor-utils--zwXXzP3.js";import{b as q,c as D,e as B,f as F,h as G}from"./index-Drjls6S5.js";import"./vendor-ui-D_1V60Zb.js";import"./vendor-monaco-DOkK7qaX.js";function V(){const[s,i]=d.useState(null),[c,j]=d.useState(""),[u,v]=d.useState(""),[m,b]=d.useState(""),[x,h]=d.useState(""),[r,p]=d.useState(!1),{data:n,loading:E,refresh:N}=g(q,{onSuccess:t=>{!s&&t.templates.length>0&&i(t.activeTemplateId)}}),a=(n==null?void 0:n.templates)||[],w=n==null?void 0:n.activeTemplateId,l=n==null?void 0:n.defaults;d.useEffect(()=>{if(r)j(""),v(""),b((l==null?void 0:l.systemPrompt)||""),h((l==null?void 0:l.userPromptTemplate)||"");else if(s){const t=a.find(S=>S.id===s);t&&(j(t.name),v(t.description||""),b(t.systemPrompt),h(t.userPromptTemplate))}},[s,r,a,l]);const{loading:y,run:k}=g(async()=>{if(!c.trim())throw new Error("模板名称不能为空");if(!m.trim())throw new Error("系统提示词不能为空");if(!x.includes("{{dailyLog}}"))throw new Error("用户提示词模板必须包含 {{dailyLog}} 占位符");r?(await D({name:c.trim(),description:u.trim()||void 0,systemPrompt:m,userPromptTemplate:x}),p(!1)):s&&await B(s,{name:c.trim(),description:u.trim()||void 0,systemPrompt:m,userPromptTemplate:x}),await N()},{manual:!0,onSuccess:()=>{o.success(r?"模板创建成功！":"保存成功！")},onError:t=>{o.error(t.message||"保存失败")}}),{loading:P,run:I}=g(async()=>{if(s){if(a.length<=1)throw new Error("至少需要保留一个模板");await F(s),i(null),await N()}},{manual:!0,onSuccess:()=>{o.success("模板已删除")},onError:t=>{o.error(t.message||"删除失败")}}),{loading:C,run:A}=g(async()=>{s&&(await G(s),await N())},{manual:!0,onSuccess:()=>{o.success("模板已激活")},onError:t=>{o.error(t.message||"激活失败")}}),L=()=>{l&&(b(l.systemPrompt),h(l.userPromptTemplate),o.info("已重置为默认值（需保存生效）"))},$=()=>{p(!0),i(null)},z=()=>{p(!1),a.length>0&&i(w||a[0].id)};if(E)return e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("div",{className:"text-[#8b949e]",children:"加载中..."})});const f=a.find(t=>t.id===s),R=s===w,T=r||f&&(c!==f.name||u!==(f.description||"")||m!==f.systemPrompt||x!==f.userPromptTemplate);return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("header",{className:"h-14 flex items-center justify-between px-6 bg-[#161b22] border-b border-[#30363d] shrink-0",children:[e.jsx("h2",{className:"text-lg font-semibold text-[#f0f6fc]",children:"Prompt 模板"}),e.jsxs("div",{className:"flex items-center gap-3",children:[!r&&s&&!R&&e.jsx("button",{onClick:A,disabled:C,className:"px-4 py-2 rounded-lg font-medium text-sm transition-all duration-200 bg-[#21262d] text-[#f0f6fc] hover:bg-[#30363d] border border-[#30363d]",children:C?"激活中...":"设为默认"}),e.jsx("button",{onClick:k,disabled:y||!r&&!T,className:`
              px-4 py-2 rounded-lg font-medium text-sm transition-all duration-200
              ${y||!r&&!T?"bg-[#21262d] text-[#484f58] cursor-not-allowed":"bg-[#238636] text-white hover:bg-[#2ea043]"}
            `,children:y?"保存中...":r?"创建模板":"保存修改"})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("aside",{className:"w-64 bg-[#161b22] border-r border-[#30363d] flex flex-col shrink-0",children:[e.jsx("div",{className:"p-4 border-b border-[#30363d]",children:e.jsx("button",{onClick:$,disabled:r,className:`
                w-full px-4 py-2 rounded-lg font-medium text-sm transition-all duration-200
                ${r?"bg-[#21262d] text-[#484f58] cursor-not-allowed":"bg-[#238636] text-white hover:bg-[#2ea043]"}
              `,children:"+ 新建模板"})}),e.jsxs("div",{className:"flex-1 overflow-auto p-3 space-y-2",children:[r&&e.jsxs("div",{className:"p-3 rounded-lg border-2 border-dashed border-[#58a6ff] bg-[#58a6ff]/10",children:[e.jsx("div",{className:"font-medium text-[#58a6ff] text-sm",children:"新建模板"}),e.jsx("div",{className:"text-xs text-[#8b949e] mt-1",children:"填写右侧表单并保存"}),e.jsx("button",{onClick:z,className:"mt-2 text-xs text-[#f85149] hover:underline",children:"取消创建"})]}),a.map(t=>{const S=!r&&s===t.id,U=t.id===w;return e.jsxs("button",{onClick:()=>{p(!1),i(t.id)},className:`
                    w-full p-3 rounded-lg border text-left transition-all duration-200
                    ${S?"bg-[#0d1117] border-[#58a6ff]":"bg-[#0d1117] border-[#30363d] hover:border-[#484f58]"}
                  `,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium text-[#f0f6fc] text-sm truncate",children:t.name}),U&&e.jsx("span",{className:"text-xs text-emerald-400 shrink-0 ml-2",children:"● 默认"})]}),t.description&&e.jsx("div",{className:"text-xs text-[#8b949e] mt-1 truncate",children:t.description}),e.jsxs("div",{className:"text-xs text-[#484f58] mt-1",children:["更新于 ",new Date(t.updatedAt).toLocaleDateString("zh-CN")]})]},t.id)})]})]}),e.jsx("main",{className:"flex-1 overflow-auto p-6",children:e.jsxs("div",{className:"max-w-3xl space-y-6",children:[e.jsxs("section",{className:"bg-[#161b22] rounded-lg border border-[#30363d] p-6",children:[e.jsx("h3",{className:"text-base font-semibold text-[#f0f6fc] mb-4",children:"基本信息"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-[#8b949e] mb-2",children:["模板名称 ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",value:c,onChange:t=>j(t.target.value),placeholder:"例如：简洁版、详细版",className:"w-full px-3 py-2 bg-[#0d1117] border border-[#30363d] rounded-lg text-[#f0f6fc] placeholder-[#484f58] focus:outline-none focus:border-[#58a6ff]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[#8b949e] mb-2",children:"描述（可选）"}),e.jsx("input",{type:"text",value:u,onChange:t=>v(t.target.value),placeholder:"简要描述这个模板的特点",className:"w-full px-3 py-2 bg-[#0d1117] border border-[#30363d] rounded-lg text-[#f0f6fc] placeholder-[#484f58] focus:outline-none focus:border-[#58a6ff]"})]})]})]}),e.jsxs("section",{className:"bg-[#161b22] rounded-lg border border-[#30363d] p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-base font-semibold text-[#f0f6fc]",children:"系统提示词 (System Prompt)"}),e.jsx("button",{onClick:L,className:"text-xs text-[#58a6ff] hover:underline",children:"重置为默认"})]}),e.jsx("p",{className:"text-sm text-[#8b949e] mb-4",children:"定义 AI 的角色和行为规则，包括输出格式要求。"}),e.jsx("textarea",{value:m,onChange:t=>b(t.target.value),rows:14,className:"w-full px-3 py-2 bg-[#0d1117] border border-[#30363d] rounded-lg text-[#f0f6fc] placeholder-[#484f58] focus:outline-none focus:border-[#58a6ff] font-mono text-sm resize-y",placeholder:"输入系统提示词..."})]}),e.jsxs("section",{className:"bg-[#161b22] rounded-lg border border-[#30363d] p-6",children:[e.jsx("h3",{className:"text-base font-semibold text-[#f0f6fc] mb-4",children:"用户提示词模板 (User Prompt Template)"}),e.jsxs("p",{className:"text-sm text-[#8b949e] mb-2",children:["用户输入的提示词模板。使用"," ",e.jsx("code",{className:"px-1.5 py-0.5 bg-[#0d1117] rounded text-[#58a6ff]",children:"{{dailyLog}}"})," ","作为日志内容的占位符。"]}),e.jsxs("div",{className:"text-xs text-yellow-400 mb-4",children:["注意：模板中必须包含 ","{{dailyLog}}"," 占位符，运行时会被实际的日志内容替换。"]}),e.jsx("textarea",{value:x,onChange:t=>h(t.target.value),rows:8,className:"w-full px-3 py-2 bg-[#0d1117] border border-[#30363d] rounded-lg text-[#f0f6fc] placeholder-[#484f58] focus:outline-none focus:border-[#58a6ff] font-mono text-sm resize-y",placeholder:"输入用户提示词模板..."})]}),!r&&s&&e.jsxs("section",{className:"bg-[#161b22] rounded-lg border border-[#f85149]/30 p-6",children:[e.jsx("h3",{className:"text-base font-semibold text-[#f85149] mb-4",children:"危险操作"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-[#f0f6fc]",children:"删除此模板"}),e.jsxs("div",{className:"text-xs text-[#8b949e] mt-1",children:["删除后无法恢复，请谨慎操作。",a.length<=1&&" （至少需要保留一个模板）"]})]}),e.jsx("button",{onClick:I,disabled:P||a.length<=1,className:`
                      px-4 py-2 rounded-lg font-medium text-sm transition-all duration-200
                      ${P||a.length<=1?"bg-[#21262d] text-[#484f58] cursor-not-allowed":"bg-[#f85149] text-white hover:bg-[#da3633]"}
                    `,children:P?"删除中...":"删除模板"})]})]})]})})]})]})}export{V as default};
