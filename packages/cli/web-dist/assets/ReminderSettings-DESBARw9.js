import{j as e}from"./vendor-markdown-BqRWHW3K.js";import{r as d}from"./vendor-react-C5jCz3x-.js";import{u as z,t as g}from"./vendor-utils-CwndgGHQ.js";import{i as H,j as J,t as q,k as L}from"./index-Badz7vV5.js";import{h as P,L as _,S as k,a as y,b as A}from"./form-utils-Ct5NYf6N.js";import{R as F,T as I,m as G,P as Q,g as B,C as U,n as V,o as Y}from"./vendor-ui-CWR1VRfy.js";import"./vendor-monaco-nD5yPjNo.js";function W({enabled:s,onChange:r,size:n="md"}){const o={sm:{track:"h-5 w-9",thumb:"h-4 w-4",translate:"translate-x-4"},md:{track:"h-6 w-11",thumb:"h-5 w-5",translate:"translate-x-5"}},{track:i,thumb:a,translate:l}=o[n];return e.jsx("button",{type:"button",role:"switch","aria-checked":s,onClick:()=>r(!s),className:`
        relative inline-flex ${i} shrink-0 cursor-pointer rounded-full 
        border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none
        ${s?"bg-emerald-500":"bg-[#484f58]"}
      `,children:e.jsx("span",{className:`
          pointer-events-none inline-block ${a} rounded-full bg-white shadow-lg ring-0 
          transition duration-200 ease-in-out
          ${s?l:"translate-x-0"}
        `})})}function X(s,r){return`${String(s).padStart(2,"0")}:${String(r).padStart(2,"0")}`}function $({values:s,selected:r,onSelect:n,label:o}){const i=d.useRef(null),a=28;return d.useEffect(()=>{if(i.current){const l=r*a;i.current.scrollTo({top:l,behavior:"smooth"})}},[r]),e.jsxs("div",{className:"flex flex-col bg-[#0d1117] rounded overflow-hidden border border-[#30363d]",children:[e.jsx("div",{className:"text-[10px] text-[#8b949e] text-center py-1 bg-[#161b22] border-b border-[#30363d]",children:o}),e.jsx("div",{ref:i,className:"h-[140px] w-12 overflow-y-auto overflow-x-hidden bg-[#0d1117] [&::-webkit-scrollbar]:w-1 [&::-webkit-scrollbar-track]:bg-[#0d1117] [&::-webkit-scrollbar-thumb]:bg-[#30363d] [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-thumb]:hover:bg-[#484f58]",style:{scrollbarWidth:"thin",scrollbarColor:"#30363d #0d1117"},children:s.map(l=>e.jsx("button",{onClick:()=>n(l),className:`
              w-full h-7 flex items-center justify-center text-xs transition-colors
              ${l===r?"bg-emerald-500/20 text-emerald-400 font-medium":"text-[#8b949e] hover:text-[#f0f6fc] hover:bg-[#21262d]"}
            `,children:String(l).padStart(2,"0")},l))})]})}const Z=[{label:"09:00",hour:9,minute:0},{label:"10:00",hour:10,minute:0},{label:"14:00",hour:14,minute:0},{label:"18:00",hour:18,minute:0},{label:"20:00",hour:20,minute:0}];function ee({hour:s,minute:r,onChange:n,disabled:o}){const[i,a]=d.useState(!1),[l,m]=d.useState(s),[h,f]=d.useState(r);d.useEffect(()=>{m(s),f(r)},[s,r]);const b=Array.from({length:24},(x,u)=>u),v=Array.from({length:60},(x,u)=>u),p=()=>{n(l,h),a(!1)},N=(x,u)=>{m(x),f(u),n(x,u),a(!1)};return e.jsxs(F,{open:i,onOpenChange:a,children:[e.jsx(I,{asChild:!0,children:e.jsxs("button",{disabled:o,className:`
            flex items-center gap-2 px-3 py-1.5 bg-[#161b22] border border-[#30363d] rounded-lg
            text-sm text-[#f0f6fc] transition-colors
            hover:border-[#58a6ff] focus:outline-none focus:border-[#58a6ff]
            disabled:opacity-50 disabled:cursor-not-allowed
          `,children:[e.jsx(G,{className:"w-4 h-4 text-[#8b949e]"}),e.jsx("span",{className:"font-mono",children:X(s,r)})]})}),e.jsx(Q,{children:e.jsx(B,{className:"z-50 bg-[#161b22] border border-[#30363d] rounded-lg shadow-xl shadow-black/50 animate-in fade-in-0 zoom-in-95",sideOffset:4,align:"start",children:e.jsxs("div",{className:"p-3",children:[e.jsx("div",{className:"flex gap-1 mb-3 pb-2 border-b border-[#30363d]",children:Z.map(x=>e.jsx("button",{onClick:()=>N(x.hour,x.minute),className:`
                    px-2 py-1 text-xs rounded transition-colors
                    ${l===x.hour&&h===x.minute?"bg-emerald-500/20 text-emerald-400":"text-[#8b949e] hover:text-[#f0f6fc] hover:bg-[#21262d]"}
                  `,children:x.label},x.label))}),e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx($,{label:"æ—¶",values:b,selected:l,onSelect:m}),e.jsx("div",{className:"flex items-center justify-center text-[#484f58] text-xl font-bold px-1",children:":"}),e.jsx($,{label:"åˆ†",values:v,selected:h,onSelect:f})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-3 pt-2 border-t border-[#30363d]",children:[e.jsx("button",{onClick:()=>a(!1),className:"px-3 py-1 text-xs text-[#8b949e] hover:text-[#f0f6fc] rounded transition-colors",children:"å–æ¶ˆ"}),e.jsx("button",{onClick:p,className:"px-3 py-1 text-xs bg-emerald-500 text-white rounded hover:bg-emerald-600 transition-colors",children:"ç¡®å®š"})]})]})})})]})}function se({checked:s,onChange:r,disabled:n,size:o="md"}){const i={sm:"w-4 h-4",md:"w-5 h-5"},a={sm:"w-3 h-3",md:"w-3.5 h-3.5"};return e.jsx("button",{type:"button",role:"checkbox","aria-checked":s,disabled:n,onClick:()=>!n&&r(!s),className:`
        ${i[o]}
        flex items-center justify-center rounded
        border-2 transition-all duration-150
        ${n?"cursor-not-allowed opacity-50":"cursor-pointer"}
        ${s?"bg-emerald-500 border-emerald-500":"bg-[#0d1117] border-[#30363d] hover:border-[#484f58]"}
      `,children:s&&e.jsx(U,{className:`${a[o]} text-white stroke-[3]`})})}const te="/assets/ding-D-gPl0Gt.png",ne="/assets/wechat-CVBu4WYM.png";function re(){return Math.random().toString(36).substring(2,10)}function ae({time:s,onChange:r,onRemove:n,canRemove:o}){return e.jsxs("div",{className:"relative group",children:[o&&e.jsx("button",{onClick:n,className:"absolute -top-1.5 -right-1.5 w-4 h-4 rounded-full bg-[#21262d] border border-[#30363d] text-[#8b949e] hover:text-red-400 hover:border-red-400/50 hover:bg-red-400/10 opacity-0 group-hover:opacity-100 transition-all flex items-center justify-center",title:"åˆ é™¤",children:e.jsx(Y,{className:"w-2.5 h-2.5"})}),e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 bg-[#0d1117] rounded-lg border border-[#30363d]",children:[e.jsx(se,{checked:s.enabled,onChange:i=>r({enabled:i}),size:"sm"}),e.jsx(ee,{hour:s.hour,minute:s.minute,onChange:(i,a)=>r({hour:i,minute:a})})]})]})}function C(s,r,n,o){return s.some(i=>i.id!==o&&i.hour===r&&i.minute===n)}function le(s){const r=[{hour:9,minute:0},{hour:10,minute:0},{hour:14,minute:0},{hour:17,minute:0},{hour:18,minute:0},{hour:20,minute:0}];for(const n of r)if(!C(s,n.hour,n.minute))return n;for(let n=0;n<24;n++)for(let o=0;o<60;o++)if(!C(s,n,o))return{hour:n,minute:o};return{hour:0,minute:0}}function D({schedules:s,onChange:r}){const n=()=>{const a=le(s.times);r({times:[...s.times,{id:re(),hour:a.hour,minute:a.minute,enabled:!0}]})},o=a=>{s.times.length<=1||r({times:s.times.filter(l=>l.id!==a)})},i=(a,l)=>{const m=s.times.find(h=>h.id===a);if(m&&(l.hour!==void 0||l.minute!==void 0)){const h=l.hour??m.hour,f=l.minute??m.minute;if(C(s.times,h,f,a)){g.error("è¯¥æ—¶é—´å·²å­˜åœ¨");return}}r({times:s.times.map(h=>h.id===a?{...h,...l}:h)})};return e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-sm text-[#8b949e]",children:"ğŸ“… æé†’æ—¶é—´"})}),e.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[s.times.map(a=>e.jsx(ae,{time:a,onChange:l=>i(a.id,l),onRemove:()=>o(a.id),canRemove:s.times.length>1},a.id)),e.jsx("button",{onClick:n,className:"flex items-center justify-center w-8 h-8 rounded-lg border border-dashed border-[#30363d] text-[#8b949e] hover:text-[#58a6ff] hover:border-[#58a6ff] transition-colors",title:"æ·»åŠ æé†’æ—¶é—´",children:e.jsx(V,{className:"w-4 h-4"})})]})]})}function K({icon:s,title:r,enabled:n,onToggle:o,children:i}){return e.jsxs("div",{className:"p-4 bg-[#0d1117] rounded-lg border border-[#30363d]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s,e.jsx("span",{className:"font-medium text-[#f0f6fc]",children:r})]}),e.jsx(W,{enabled:n,onChange:o,size:"sm"})]}),i]})}function ue(){const[s,r]=d.useState(null),[n,o]=d.useState(""),[i,a]=d.useState(""),[l,m]=d.useState(""),[h,f]=d.useState(!1),[b,v]=d.useState(null),p=d.useRef(null),{loading:N,refresh:x}=z(H,{onSuccess:t=>{var E,R;r(t);const c=t.channels.dingtalk.webhook||"",j=t.channels.dingtalk.secret||"",T=t.channels.serverChan.sendKey||"";o(c),a(j),m(T),p.current={enabled:t.enabled,dingtalkEnabled:t.channels.dingtalk.enabled||!1,dingtalkWebhook:c,dingtalkSecret:j,dingtalkSchedules:JSON.stringify(((E=t.channels.dingtalk.schedules)==null?void 0:E.times)||[]),serverChanEnabled:t.channels.serverChan.enabled||!1,serverChanSendKey:T,serverChanSchedules:JSON.stringify(((R=t.channels.serverChan.schedules)==null?void 0:R.times)||[])}},onError:t=>g.error(t.message||"åŠ è½½é…ç½®å¤±è´¥")}),u=d.useMemo(()=>{var c,j;if(!s)return!1;const t={enabled:s.enabled,dingtalkEnabled:s.channels.dingtalk.enabled,dingtalkWebhook:n,dingtalkSecret:i,dingtalkSchedules:JSON.stringify(((c=s.channels.dingtalk.schedules)==null?void 0:c.times)||[]),serverChanEnabled:s.channels.serverChan.enabled,serverChanSendKey:l,serverChanSchedules:JSON.stringify(((j=s.channels.serverChan.schedules)==null?void 0:j.times)||[])};return P(t,p.current)},[s,n,i,l]),w=(t,c)=>{s&&r({...s,channels:{...s.channels,[t]:{...s.channels[t],schedules:c}}})},O=()=>{if(!p.current)return;const t=p.current;r(c=>c&&{...c,enabled:t.enabled,channels:{dingtalk:{enabled:t.dingtalkEnabled,webhook:t.dingtalkWebhook,secret:t.dingtalkSecret,schedules:{times:JSON.parse(t.dingtalkSchedules)}},serverChan:{enabled:t.serverChanEnabled,sendKey:t.serverChanSendKey,schedules:{times:JSON.parse(t.serverChanSchedules)}}}}),o(t.dingtalkWebhook),a(t.dingtalkSecret),m(t.serverChanSendKey),g.info("å·²é‡ç½®ä¸ºåŸå§‹é…ç½®")},M=async()=>{if(s){f(!0);try{const t={enabled:s.enabled,channels:{dingtalk:{enabled:s.channels.dingtalk.enabled,webhook:n.trim(),secret:i.trim(),schedules:s.channels.dingtalk.schedules},serverChan:{enabled:s.channels.serverChan.enabled,sendKey:l.trim(),schedules:s.channels.serverChan.schedules}}};await J(t),g.success("é…ç½®ä¿å­˜æˆåŠŸ"),await x()}catch(t){g.error(t instanceof Error?t.message:"ä¿å­˜å¤±è´¥")}finally{f(!1)}}},S=async t=>{v(t);try{const c=t==="dingtalk"?await q(n.trim(),i.trim()||void 0):await L(l.trim());c.success?g.success(t==="dingtalk"?"é’‰é’‰æµ‹è¯•æ¶ˆæ¯å‘é€æˆåŠŸ":"æµ‹è¯•æ¶ˆæ¯å‘é€æˆåŠŸï¼Œè¯·æŸ¥çœ‹å¾®ä¿¡"):g.error(c.error||"å‘é€å¤±è´¥")}catch(c){g.error(c instanceof Error?c.message:"æµ‹è¯•å¤±è´¥")}finally{v(null)}};return N||!s?e.jsx(_,{}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("header",{className:"h-14 flex items-center px-6 bg-[#161b22] border-b border-[#30363d] shrink-0",children:e.jsx("h2",{className:"text-lg font-semibold text-[#f0f6fc]",children:"æé†’è®¾ç½®"})}),e.jsx("main",{className:"flex-1 overflow-auto p-6 pb-20",children:e.jsxs("div",{className:"max-w-3xl space-y-6",children:[e.jsx(k,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-[#f0f6fc]",children:"å¯ç”¨æé†’"}),e.jsx("p",{className:"text-sm text-[#8b949e] mt-1",children:"å¼€å¯åï¼Œå°†åœ¨æ³•å®šå·¥ä½œæ—¥é€šè¿‡å·²é…ç½®çš„æ¸ é“æ¨é€æé†’"}),e.jsx("p",{className:"text-xs text-[#484f58] mt-1",children:"ğŸ’¡ è‡ªåŠ¨è·³è¿‡èŠ‚å‡æ—¥ï¼ŒåŒ…å«è°ƒä¼‘å·¥ä½œæ—¥"})]}),e.jsx(W,{enabled:s.enabled,onChange:t=>r({...s,enabled:t})})]})}),e.jsxs(k,{children:[e.jsx(y,{title:"æ¨é€æ¸ é“",description:"æ¯ä¸ªæ¸ é“å¯ç‹¬ç«‹é…ç½®æé†’æ—¶é—´"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(K,{icon:e.jsx("div",{className:"w-5 h-5 overflow-hidden flex-shrink-0",children:e.jsx("img",{src:te,alt:"é’‰é’‰",className:"h-5",style:{width:"80px",maxWidth:"none"}})}),title:"é’‰é’‰æœºå™¨äºº",enabled:s.channels.dingtalk.enabled,onToggle:t=>r({...s,channels:{...s.channels,dingtalk:{...s.channels.dingtalk,enabled:t}}}),children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-[#8b949e] mb-1.5",children:"Webhook åœ°å€"}),e.jsx("input",{type:"text",value:n,onChange:t=>o(t.target.value),placeholder:"https://oapi.dingtalk.com/robot/send?access_token=...",className:"w-full px-3 py-2 bg-[#161b22] border border-[#30363d] rounded-lg text-[#f0f6fc] placeholder-[#484f58] focus:outline-none focus:border-[#58a6ff] text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-[#8b949e] mb-1.5",children:["åŠ ç­¾å¯†é’¥ ",e.jsx("span",{className:"text-[#484f58]",children:"(å¯é€‰ï¼Œæ¨èé…ç½®)"})]}),e.jsx("input",{type:"text",value:i,onChange:t=>a(t.target.value),placeholder:"SECxxxxxxxxxxxxxxxxxxxxxxxx",className:"w-full px-3 py-2 bg-[#161b22] border border-[#30363d] rounded-lg text-[#f0f6fc] placeholder-[#484f58] focus:outline-none focus:border-[#58a6ff] text-sm"})]}),e.jsx(D,{schedules:s.channels.dingtalk.schedules,onChange:t=>w("dingtalk",t)}),e.jsxs("div",{className:"flex items-center justify-between pt-1",children:[e.jsx("p",{className:"text-xs text-[#484f58]",children:"ğŸ’¡ åœ¨é’‰é’‰ç¾¤è®¾ç½®ä¸­æ·»åŠ è‡ªå®šä¹‰æœºå™¨äººè·å– Webhook"}),e.jsx("button",{onClick:()=>S("dingtalk"),disabled:b==="dingtalk"||!n.trim(),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all duration-200 ${b==="dingtalk"||!n.trim()?"bg-[#21262d] text-[#484f58] cursor-not-allowed":"bg-[#21262d] text-[#f0f6fc] hover:bg-[#30363d]"}`,children:b==="dingtalk"?"å‘é€ä¸­...":"æµ‹è¯•"})]})]})}),e.jsx(K,{icon:e.jsx("img",{src:ne,alt:"å¾®ä¿¡",className:"w-5 h-5",style:{filter:"brightness(0) saturate(100%) invert(48%) sepia(79%) saturate(2476%) hue-rotate(118deg) brightness(95%) contrast(101%)"}}),title:"Serveré…±ï¼ˆå¾®ä¿¡æ¨é€ï¼‰",enabled:s.channels.serverChan.enabled,onToggle:t=>r({...s,channels:{...s.channels,serverChan:{...s.channels.serverChan,enabled:t}}}),children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-[#8b949e] mb-1.5",children:"SendKey"}),e.jsx("input",{type:"text",value:l,onChange:t=>m(t.target.value),placeholder:"SCTxxxxxxxxxxxxxxxxxxx",className:"w-full px-3 py-2 bg-[#161b22] border border-[#30363d] rounded-lg text-[#f0f6fc] placeholder-[#484f58] focus:outline-none focus:border-[#58a6ff] text-sm"})]}),e.jsx(D,{schedules:s.channels.serverChan.schedules,onChange:t=>w("serverChan",t)}),e.jsxs("div",{className:"flex items-center justify-between pt-1",children:[e.jsxs("p",{className:"text-xs text-[#484f58]",children:["ğŸ’¡ è®¿é—® ",e.jsx("a",{href:"https://sct.ftqq.com/",target:"_blank",rel:"noopener noreferrer",className:"text-[#58a6ff] hover:underline",children:"sct.ftqq.com"})," ç”¨ GitHub ç™»å½•è·å–ï¼Œæ¯å¤©å…è´¹ 5 æ¡"]}),e.jsx("button",{onClick:()=>S("serverChan"),disabled:b==="serverChan"||!l.trim(),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all duration-200 ${b==="serverChan"||!l.trim()?"bg-[#21262d] text-[#484f58] cursor-not-allowed":"bg-[#21262d] text-[#f0f6fc] hover:bg-[#30363d]"}`,children:b==="serverChan"?"å‘é€ä¸­...":"æµ‹è¯•"})]})]})})]})]}),e.jsxs(k,{children:[e.jsx(y,{title:"èŠ‚å‡æ—¥æ•°æ®"}),s.holidayData?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-emerald-400",children:"âœ“"}),e.jsxs("span",{className:"text-[#f0f6fc]",children:[s.holidayData.year,"å¹´æ•°æ®å·²åŠ è½½"]})]}),e.jsxs("p",{className:"text-sm text-[#8b949e]",children:["æ•°æ®æ¥æºï¼š",s.holidayData.source]}),e.jsxs("p",{className:"text-xs text-[#484f58]",children:["æ›´æ–°æ—¶é—´ï¼š",s.holidayData.updatedAt," Â· ",s.holidayData.holidaysCount," ä¸ªèŠ‚å‡æ—¥ Â· ",s.holidayData.workdaysCount," ä¸ªè°ƒä¼‘å·¥ä½œæ—¥"]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-yellow-400",children:"âš "}),e.jsx("span",{className:"text-[#8b949e]",children:"å½“å‰å¹´ä»½æš‚æ— èŠ‚å‡æ—¥æ•°æ®ï¼Œå°†ä½¿ç”¨å‘¨æœ«åˆ¤æ–­"})]})]}),e.jsxs(k,{children:[e.jsx(y,{title:"å®šæ—¶ä»»åŠ¡çŠ¶æ€"}),e.jsx("div",{className:"flex items-center gap-2",children:s.scheduler.running?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-400 animate-pulse"}),e.jsx("span",{className:"text-emerald-400",children:"è¿è¡Œä¸­"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-[#484f58]"}),e.jsx("span",{className:"text-[#8b949e]",children:"æœªè¿è¡Œ"})]})}),!s.scheduler.running&&s.enabled&&e.jsx("p",{className:"text-xs text-yellow-400 mt-2",children:"ğŸ’¡ ä¿å­˜é…ç½®åå®šæ—¶ä»»åŠ¡å°†è‡ªåŠ¨å¯åŠ¨"})]})]})}),e.jsx(A,{status:u?"changed":"synced",showReset:u,onReset:O,saveText:"ä¿å­˜é…ç½®",onSave:M,saving:h,saveDisabled:!u})]})}export{ue as default};
