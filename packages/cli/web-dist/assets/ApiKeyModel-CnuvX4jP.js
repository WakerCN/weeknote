import{j as e}from"./vendor-markdown-CCDUxFZN.js";import{r as p}from"./vendor-react-BCbWnUzD.js";import{u as k,b as f}from"./vendor-utils--zwXXzP3.js";import{s as C,d as M,g as A,a as K}from"./index-Drjls6S5.js";import"./vendor-ui-D_1V60Zb.js";import"./vendor-monaco-DOkK7qaX.js";const w=[{key:"siliconflow",name:"硅基流动",url:"https://cloud.siliconflow.cn/"},{key:"deepseek",name:"DeepSeek",url:"https://platform.deepseek.com/"},{key:"openai",name:"OpenAI",url:"https://platform.openai.com/"}];function S(l){return l.length<=8?"****":`${l.slice(0,4)}...${l.slice(-4)}`}function L({name:l,url:j,apiKey:a,onSave:y,onDelete:g}){const[m,d]=p.useState(!1),[o,x]=p.useState(!1),[c,h]=p.useState(""),[u,v]=p.useState(!1),[N,b]=p.useState(!1),s=!!a,i=async()=>{if(!c.trim()){f.error("请输入 API Key");return}v(!0);try{await y(c.trim()),h(""),d(!1)}finally{v(!1)}},r=async()=>{b(!0);try{await g()}finally{b(!1)}},t=()=>{d(!1),h("")};return e.jsxs("div",{className:"p-4 bg-[#0d1117] rounded-lg border border-[#30363d]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-[#f0f6fc]",children:l}),s&&!m?e.jsx("span",{className:"text-xs text-emerald-400",children:"✓ 已配置"}):e.jsx("span",{className:"text-xs text-[#8b949e]",children:"未配置"})]}),e.jsx("a",{href:j,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-[#58a6ff] hover:underline",children:"获取 API Key →"})]}),e.jsx("div",{className:"h-10",children:s&&!m?e.jsxs("div",{className:"flex items-center gap-3 h-full",children:[e.jsx("div",{className:"flex-1 px-3 h-full flex items-center bg-[#161b22] border border-[#30363d] rounded-lg font-mono text-sm text-[#8b949e] overflow-x-auto cursor-not-allowed opacity-70 hover:opacity-60 transition-opacity",children:e.jsx("span",{className:"whitespace-nowrap",children:o?a:S(a)})}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx("button",{onClick:()=>x(!o),className:"w-8 h-8 flex items-center justify-center rounded-lg text-[#8b949e] hover:text-[#f0f6fc] hover:bg-[#21262d] transition-colors",title:o?"隐藏":"显示",children:o?e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),e.jsx("button",{onClick:()=>d(!0),className:"w-8 h-8 flex items-center justify-center rounded-lg text-[#8b949e] hover:text-[#f0f6fc] hover:bg-[#21262d] transition-colors",title:"编辑",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{onClick:r,disabled:N,className:"w-8 h-8 flex items-center justify-center rounded-lg text-[#8b949e] hover:text-[#f85149] hover:bg-[#f85149]/10 transition-colors disabled:opacity-50",title:"删除",children:N?e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}):e.jsxs("div",{className:"flex gap-2 h-full",children:[e.jsx("input",{type:"password",value:c,onChange:n=>h(n.target.value),onKeyDown:n=>{n.key==="Enter"&&c.trim()&&i(),n.key==="Escape"&&t()},placeholder:"请输入 API Key",autoFocus:m,className:"flex-1 px-3 h-full bg-[#161b22] border border-[#30363d] rounded-lg text-[#f0f6fc] placeholder-[#484f58] focus:outline-none focus:border-[#58a6ff]"}),e.jsx("button",{onClick:i,disabled:u||!c.trim(),className:`
                px-4 h-full rounded-lg font-medium text-sm transition-all duration-200 shrink-0
                ${u||!c.trim()?"bg-[#21262d] text-[#484f58] cursor-not-allowed":"bg-[#238636] text-white hover:bg-[#2ea043]"}
              `,children:u?"保存中...":"保存"}),m&&e.jsx("button",{onClick:t,className:"px-4 h-full rounded-lg font-medium text-sm transition-all duration-200 bg-[#21262d] text-[#8b949e] hover:text-[#f0f6fc] hover:bg-[#30363d]",children:"取消"})]})})]})}function V(){const[l,j]=p.useState(null),{data:a,loading:y}=k(A),{data:g,loading:m,refresh:d}=k(K),o=(a==null?void 0:a.models)||[],x=g||{defaultModel:null,apiKeys:{siliconflow:null,deepseek:null,openai:null}},c=(y||m)&&!a&&!g,h=s=>s.startsWith("siliconflow/")?"siliconflow":s.startsWith("deepseek/")?"deepseek":"openai",u=s=>!!x.apiKeys[s],v=async(s,i)=>{var r;try{await C({apiKeys:{[s]:i}}),await d(),f.success(`${(r=w.find(t=>t.key===s))==null?void 0:r.name} API Key 保存成功`)}catch(t){throw f.error(t instanceof Error?t.message:"保存失败"),t}},N=async s=>{var i;try{await M(s),await d(),f.success(`${(i=w.find(r=>r.key===s))==null?void 0:i.name} API Key 已删除`)}catch(r){throw f.error(r instanceof Error?r.message:"删除失败"),r}},b=async s=>{var r;if(s===x.defaultModel)return;const i=((r=o.find(t=>t.id===s))==null?void 0:r.name)||s;j(s);try{await C({defaultModel:s}),await d(),f.success(`默认模型已切换到: ${i}`)}catch(t){f.error(t instanceof Error?t.message:"切换失败")}finally{j(null)}};return c?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("div",{className:"text-[#8b949e]",children:"加载中..."})}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("header",{className:"h-14 flex items-center px-6 bg-[#161b22] border-b border-[#30363d] shrink-0",children:e.jsx("h2",{className:"text-lg font-semibold text-[#f0f6fc]",children:"模型与 API Key"})}),e.jsx("main",{className:"flex-1 overflow-auto p-6",children:e.jsxs("div",{className:"max-w-3xl space-y-8",children:[e.jsxs("section",{className:"bg-[#161b22] rounded-lg border border-[#30363d] p-6",children:[e.jsx("h3",{className:"text-base font-semibold text-[#f0f6fc] mb-2",children:"API Keys"}),e.jsx("p",{className:"text-sm text-[#8b949e] mb-6",children:"配置各平台的 API Key 以启用对应的模型。"}),e.jsx("div",{className:"space-y-4",children:w.map(({key:s,name:i,url:r})=>e.jsx(L,{name:i,url:r,apiKey:x.apiKeys[s],onSave:t=>v(s,t),onDelete:()=>N(s)},s))})]}),e.jsxs("section",{className:"bg-[#161b22] rounded-lg border border-[#30363d] p-6",children:[e.jsx("h3",{className:"text-base font-semibold text-[#f0f6fc] mb-2",children:"默认模型"}),e.jsx("p",{className:"text-sm text-[#8b949e] mb-6",children:"点击选择生成周报时使用的默认模型，选择后立即生效。"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-emerald-400 mb-3",children:"免费模型"}),e.jsx("div",{className:"grid gap-3",children:o.filter(s=>s.isFree).map(s=>{const i=h(s.id),r=u(i),t=x.defaultModel===s.id,n=l===s.id;return e.jsxs("button",{onClick:()=>b(s.id),disabled:n||t,className:`
                          w-full p-4 rounded-lg border text-left transition-all duration-200 relative
                          ${t?"bg-emerald-500/10 border-emerald-500/50":"bg-[#0d1117] border-[#30363d] hover:border-[#484f58]"}
                          ${n?"opacity-70":""}
                        `,children:[n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[#0d1117]/50 rounded-lg",children:e.jsx("span",{className:"text-sm text-[#8b949e]",children:"切换中..."})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-[#f0f6fc]",children:[s.name,t&&e.jsx("span",{className:"ml-2 text-xs text-emerald-400",children:"● 当前默认"})]}),e.jsx("div",{className:"text-sm text-[#8b949e] mt-1",children:s.description}),e.jsx("div",{className:"text-xs text-[#484f58] mt-1",children:s.id})]}),e.jsx("div",{className:"text-right",children:r?e.jsx("span",{className:"text-xs text-emerald-400",children:"可用"}):e.jsx("span",{className:"text-xs text-yellow-400",children:"需配置 Key"})})]})]},s.id)})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-400 mb-3",children:"收费模型"}),e.jsx("div",{className:"grid gap-3",children:o.filter(s=>!s.isFree).map(s=>{const i=h(s.id),r=u(i),t=x.defaultModel===s.id,n=l===s.id;return e.jsxs("button",{onClick:()=>b(s.id),disabled:n||t,className:`
                          w-full p-4 rounded-lg border text-left transition-all duration-200 relative
                          ${t?"bg-yellow-500/10 border-yellow-500/50":"bg-[#0d1117] border-[#30363d] hover:border-[#484f58]"}
                          ${n?"opacity-70":""}
                        `,children:[n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[#0d1117]/50 rounded-lg",children:e.jsx("span",{className:"text-sm text-[#8b949e]",children:"切换中..."})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-[#f0f6fc]",children:[s.name,t&&e.jsx("span",{className:"ml-2 text-xs text-yellow-400",children:"● 当前默认"})]}),e.jsx("div",{className:"text-sm text-[#8b949e] mt-1",children:s.description}),e.jsx("div",{className:"text-xs text-[#484f58] mt-1",children:s.id})]}),e.jsx("div",{className:"text-right",children:r?e.jsx("span",{className:"text-xs text-emerald-400",children:"可用"}):e.jsx("span",{className:"text-xs text-yellow-400",children:"需配置 Key"})})]})]},s.id)})})]})]})]})})]})}export{V as default};
