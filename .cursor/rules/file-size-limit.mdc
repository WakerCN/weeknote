---
description: 文件大小指导原则 - 单文件建议不超过300行，适度拆分
alwaysApply: true
---

# 文件大小指导原则

## 核心原则

**单文件代码行数建议不超过300行。** 这是一个指导原则，而非硬性要求。

**重要：不要为了拆分而拆分。** 拆分应该基于实际需要，在文件变长、难以维护时才考虑拆分。

## 何时考虑拆分

### ✅ 应该拆分的情况

1. **文件已经变长**：在开发过程中，文件逐渐增长到300行以上
2. **维护困难**：代码逻辑复杂，难以理解和修改
3. **职责不清**：一个文件承担了多个职责
4. **有明确的可复用逻辑**：发现可以提取为独立 Hook 或组件的逻辑

### ❌ 不应该拆分的情况

1. **文件虽然超过300行，但逻辑清晰**：如果代码结构清晰、职责单一，可以保持现状
2. **为了拆分而拆分**：不要强制拆分，拆分粒度不是越小越好
3. **文件刚创建**：新文件即使超过300行，如果逻辑清晰，可以先保持

## 拆分策略（渐进式重构）

### 1. 提取自定义 Hooks
当发现状态管理逻辑复杂且可复用时，提取为独立的 Hook。

**触发时机：**
- 文件中有复杂的状态管理逻辑
- 发现可以复用的状态逻辑
- 状态逻辑影响文件可读性

**示例：**
```typescript
// 开发过程中发现文件变长，提取状态管理
// pages/Auth/index.tsx (从881行 → ~650行)
// pages/Auth/useAuthForm.ts (~100行)  // 提取表单状态管理
// pages/Auth/useCountdown.ts (~50行)  // 提取倒计时逻辑
```

### 2. 拆分子组件
当发现独立的 UI 组件可以复用或影响主文件可读性时拆分。

**触发时机：**
- 组件逻辑独立且复杂
- 组件可以在其他地方复用
- 组件影响主文件的可读性

**注意：** 不要过度拆分，简单的内联组件可以保留在主文件中。

### 3. 提取工具函数
当工具函数较多且影响主文件可读性时提取。

**触发时机：**
- 工具函数较多（5个以上）
- 工具函数可以在其他地方复用
- 工具函数影响主文件的可读性

## 拆分原则

### ✅ 适度拆分
- 保持主组件包含主要业务逻辑
- 只拆分真正需要独立的部分
- 参考项目现有组织方式（如 Home、DailyLog、Auth 页面）

### ❌ 避免过度拆分
- 不要为了达到300行而强制拆分
- 不要将简单的逻辑拆分成多个文件
- 不要创建过多的子目录和文件

## 项目参考

参考项目中其他页面的组织方式（这些都是在开发过程中逐步优化的）：

- `Home/index.tsx` (~724行) + `useEditor.ts` + `useGeneration.ts`
- `DailyLog/index.tsx` (~204行) + `useDateSwitching.ts` + `useExportRange.ts`
- `Auth/index.tsx` (~650行) + `useAuthForm.ts` + `useCountdown.ts`

**注意：** Home 页面虽然超过300行，但逻辑清晰，可以保持现状。如果后续发现维护困难，再考虑进一步拆分。

## 检查方式

在编写或重构代码时：

1. **新文件**：可以超过300行，只要逻辑清晰
2. **现有文件变长**：当文件增长到300行以上时，评估是否需要拆分
3. **维护困难**：如果发现文件难以维护，考虑拆分
4. **适度拆分**：拆分时保持适度，不要过度拆分

## 例外情况

以下情况可以适当放宽限制：

1. **配置文件**：如 `vite.config.ts`、`tailwind.config.js` 等
2. **类型定义文件**：纯类型定义文件
3. **测试文件**：测试文件可以适当放宽
4. **逻辑清晰的大文件**：如果代码结构清晰、职责单一，可以保持

## 总结

- ✅ **指导原则**：300行是建议，不是硬性要求
- ✅ **渐进式重构**：在文件变长、难以维护时才拆分
- ✅ **适度拆分**：拆分粒度要合理，不要过度拆分
- ✅ **基于实际需要**：拆分应该解决实际问题，而不是为了拆分而拆分
